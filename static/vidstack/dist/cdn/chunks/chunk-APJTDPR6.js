import { k, h, b, e } from './chunk-S66KXE42.js';
import { s, m, A as A$2, g, d } from './chunk-NHJRSSLH.js';
import { x, v as v$1, V, m as m$1 } from './chunk-OQQW4RVA.js';
import { o, j, t, A as A$1, c, p, v } from './chunk-KZR5HH3N.js';

function F(e,r="preconnect"){let t=document.querySelector(`link[href="${e}"]`);if(!o(t))return !0;let n=document.createElement("link");return n.rel=r,n.href=e,n.crossOrigin="true",document.head.append(n),!0}var T={};function K(e){if(T[e])return T[e].promise;let r=V(),t=document.querySelector(`script[src="${e}"]`);if(!o(t))return r.resolve(),r.promise;let n=document.createElement("script");return n.src=e,n.onload=()=>{r.resolve(),delete T[e];},n.onerror=()=>{r.reject(),delete T[e];},setTimeout(()=>document.head.append(n),0),r.promise}function Q(e){return e instanceof Error?e:Error(JSON.stringify(e))}async function B(e,{player:r,delegate:t$1,logger:n}){let L={onLoadStart(){x(r,"hls-lib-load-start");},onLoaded(l){x(r,"hls-lib-loaded",{detail:l});},onLoadError(l){let h=Q(l);x(r,"hls-lib-load-error",{detail:h}),t$1.dispatch("error",{detail:{message:h.message,code:4}});}},c=await re(e,L);if(p(c)&&!t(e)&&(c=await te(e,L)),!c)return null;if(!c.isSupported()){let l="[vidstack]: `hls.js` is not supported in this environment";return x(r,"hls-unsupported"),t$1.dispatch("error",{detail:{message:l,code:4}}),null}return c}async function te(e,r={}){if(!p(e)){if(r.onLoadStart?.(),e.prototype&&e.prototype!==Function)return r.onLoaded?.(e),e;try{let t=(await e())?.default;if(t&&t.isSupported)r.onLoaded?.(t);else throw Error("");return t}catch(t){r.onLoadError?.(t);}}}async function re(e,r={}){if(t(e)){r.onLoadStart?.();try{if(await K(e),!v(window.Hls))throw Error("");let t=window.Hls;return r.onLoaded?.(t),t}catch(t){r.onLoadError?.(t);}}}var G=Symbol(0),A=Symbol(0);var oe=e=>m$1(e);function X(e$1,{player:r,logger:t,delegate:n,$store:L,qualities:c$1,audioTracks:l,textTracks:h$1},J){A$1(()=>{let o=e$1.$ctor();if(!o)return;let a=c(()=>L.streamType).includes("live"),u=c(()=>L.streamType).includes("ll-"),i=new o({lowLatencyMode:u,backBufferLength:u?4:a?8:void 0,renderTextTracksNatively:!1,...e$1.config});for(let p of Object.values(o.Events))i.on(p,W);i.on(o.Events.ERROR,ee),e$1.$instance.set(i);for(let p of J)p(i);return x(r,"hls-instance",{detail:i}),i.attachMedia(e$1.media),i.on(o.Events.AUDIO_TRACK_SWITCHED,z),i.on(o.Events.LEVEL_SWITCHED,Z),i.on(o.Events.LEVEL_LOADED,q),i.on(o.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(p,d)=>{let f=new v$1(p,{detail:d}),S=-1;for(let s=0;s<d.tracks.length;s++){let E=d.tracks[s],x=E.subtitleTrack??E.closedCaptions,y=new h({id:`hls-${E.kind}${s}`,src:x?.url,label:E.label,language:x?.lang,kind:E.kind});y[b]=2,y[e]=()=>{y.mode==="showing"?(i.subtitleTrack=s,S=s):S===s&&(i.subtitleTrack=-1,S=-1);},E.default&&y.setMode("showing",f),h$1.add(y,f);}}),i.on(o.Events.CUES_PARSED,(p,d)=>{let f=h$1.getById(`hls-${d.track}`);if(!f)return;let S=new v$1(p,{detail:d});for(let s of d.cues)s.positionAlign="auto",f.addCue(s,S);}),c$1[A]=()=>{i.currentLevel=-1;},c$1.addEventListener("change",()=>{c$1.auto||(i[c$1.switch+"Level"]=c$1.selectedIndex,m&&(e$1.video.currentTime=e$1.video.currentTime));}),l.addEventListener("change",()=>{i.audioTrack!==l.selectedIndex&&(i.audioTrack=l.selectedIndex);}),n.dispatch("provider-setup",{detail:e$1}),()=>{c$1[A]=void 0,i.destroy(),e$1.$instance.set(null);}}),A$1(()=>{if(!L.live)return;let o=e$1.$instance();if(!o)return;let a=A$2(()=>{L.liveSyncPosition=o.liveSyncPosition??1/0;});return a.start(),a.stop});function W(o,a){r.dispatchEvent(new v$1(oe(o),{detail:a}));}function z(o,a){let u=l[a.id];u&&l[g](u,!0,new v$1(o,{detail:a}));}function Z(o,a){let u=c$1[a.level];u&&c$1[g](u,!0,new v$1(o,{detail:a}));}function q(o,a){if(L.canPlay)return;let{type:u,live:i,totalduration:p}=a.details,d$1=new v$1(o,{detail:a});n.dispatch("stream-type-change",{detail:i?u==="EVENT"&&Number.isFinite(p)?"live:dvr":"live":"on-demand",trigger:d$1}),n.dispatch("duration-change",{detail:p,trigger:d$1});let f=e$1.instance,S=f.media;f.currentLevel===-1&&c$1[G](!0,d$1);for(let s of f.audioTracks)l[d]({id:s.id+"",label:s.name,language:s.lang||"",kind:"main"},d$1);for(let s of f.levels)c$1[d]({width:s.width,height:s.height,codec:s.codecSet,bitrate:s.bitrate},d$1);S.dispatchEvent(new v$1("canplay",{trigger:d$1}));}function ee(o,a){if(a.fatal)switch(a.type){case"networkError":e$1.instance?.startLoad();break;case"mediaError":e$1.instance?.recoverMediaError();break;default:e$1.instance?.destroy(),e$1.$instance.set(null);break}}}var ne=Symbol(0),ie="https://cdn.jsdelivr.net",se,I=class extends k{constructor(){super(...arguments);this[se]=!0;this.$ctor=j(null);this.$instance=j(null);this.Ae=new Set;this.ye=`${ie}/npm/hls.js@^1.0.0/dist/hls.min.js`;this.config={};}get type(){return "hls"}get canLiveSync(){return !0}get library(){return this.ye}set library(t){this.ye=t;}preconnect(){t(this.ye)&&F(this.ye);}setup(t){super.setup(t),B(this.ye,t).then(n=>this.$ctor.set(()=>n)),X(this,t,this.Ae);}get ctor(){return this.$ctor()}get instance(){return this.$instance()}async loadSource({src:t$1}){A$1(()=>{if(!t(t$1))return;this.$instance()?.loadSource(t$1);});}onInstance(t){let n=c(this.$instance);return n&&t(n),this.Ae.add(t),()=>this.Ae.delete(t)}};se=ne,I.supported=s();

export { G as a, A as b, Q as c, F as d, ne as e, I as f };
